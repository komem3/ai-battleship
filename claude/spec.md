## 仕様

バトルシップのアプリケーションを作成したいです。
詳しいルールは以下から見れます。
https://ja.wikipedia.org/wiki/%E6%B5%B7%E6%88%A6%E3%82%B2%E3%83%BC%E3%83%A0

細かい要望は以下です。

- 2~5人で対戦したいので、人数を調整できるようにしたいです。
- 2人以上の場合は常にフリーフォーオール方式です。
- ボードは全員で共有です。各プレイヤーが自分の艦船を共有ボード上に配置し、自分の艦船のみ見える状態になります。
- 3人以上の場合は人のボードを攻撃するのではなく共有のボードを攻撃します。
- 2人以上の場合は、人数に合わせてボードの大きさが変わるようにしてください。(2人の場合は5x5、3人の場合は7x7、4人なら10x10、5人なら12x12)
- 1ターンに攻撃できる座標は一つです。
- もし艦船の座標が重複してしまった状態で砲撃を受けた場合、重複している全ての艦船にしぶき及びヒット判定が働きます。
- ターンの進行はプレイヤーが順番に攻撃して進行するようにしてください。
- 全ての船が沈没するとそのユーザは負けです。
- 勝利条件はターン数経過と、最後の一人になるまでの二つです。ターン数はホストがゲーム開始時にターン数を設定できるようにします.
- 艦船の数が多いプレイヤーが勝利プレイヤーです。複数人いる場合は同位になります。
- ターン数が終了した場合、残っている艦船の数によって勝敗を決定します
- サーバは使いたくないので、webRTC を使用し、ホストに対して参加者が接続してゲームの進行を同期する P2P 形式にして下さい。
- webRTCのシグナリングのためにはWebSocketサーバーは使用します。
- ホストがゲームを作成し、WebSocketサーバー上に部屋（セッション）を作成しますが、あくまで webSocketはシグナルの交換のみに使用し、ゲームでは使用しないで下さい。
- ゲーム内でユーザが行なったアクションンは履歴として管理して、各ユーザがそれをいつでも見れるようにしてください。
- アクションの内容は以下です。
  - ユーザが攻撃した座標
  - どのユーザが攻撃で被弾したか・水しぶきを見たか・沈没したか
  - 時間
- 艦船はプレーヤーがゲームを開始するときに自動配置です。
- 履歴はテキストベースでいいです。
- UI は分かりやすくしてください。

## 開発の進めかた

- 要件で分からない所は逐次質問してください。そのやり取りはこのファイルの QA に記載してください。
- テストを書くことで、デグレが起きないようにしてください。
- 技術スタックは react + vite + tailwind で進めてください。
- その他、利用するライブラリは毎回調査を行ない最適なものを選択してください。

## 実装済み機能

### ✅ 完了済み
- **P2P通信アーキテクチャ**: WebRTCを使用したピアツーピア通信でゲーム進行を実現
- **シグナリングサーバー**: WebSocketサーバーでWebRTC接続確立のためのシグナル交換
- **多人数対戦**: 2-5人でのフリーフォーオール方式
- **動的ボードサイズ**: 人数に応じたボードサイズ (2人:5x5, 3人:7x7, 4人:10x10, 5人:12x12)
- **共有ボードシステム**: 全プレイヤーが同一ボード上に艦船を配置
- **自動艦船配置**: ゲーム開始時の自動ランダム配置
- **ターン制攻撃システム**: 1ターン1座標の攻撃
- **重複艦船ダメージ**: 同一座標の複数艦船への同時ダメージ処理
- **勝利条件判定**: 最後の生存者またはターン数上限での勝敗決定
- **アクション履歴**: 攻撃、被弾、沈没の詳細履歴とタイムスタンプ
- **リアルタイム同期**: WebRTCデータチャネルでのゲーム状態同期
- **接続状態表示**: ロビーでのWebRTC接続状況の可視化

### 🏗️ アーキテクチャ
```
┌─────────────────┐    WebSocket     ┌─────────────────┐
│   Host Player   │ ←──(Signaling)──→ │ Signaling Server│
└─────────────────┘                   └─────────────────┘
         │                                      ↑
         │ WebRTC P2P                           │ WebSocket
         │ (Game Data)                          │ (Signaling)
         ↓                                      ↓
┌─────────────────┐                   ┌─────────────────┐
│ Guest Player 1  │ ←──WebRTC P2P────→ │ Guest Player 2  │
└─────────────────┘   (Game Data)      └─────────────────┘
```

### 🔧 技術実装詳細
- **フロントエンド**: React 19.1.0 + Vite 7.0.0 + Tailwind CSS 4.1.11
- **通信層**: WebRTC DataChannel (ゲーム進行) + WebSocket (シグナリングのみ)
- **状態管理**: Custom React Hooks (useGameState, useWebRTC)
- **P2P接続**: RTCPeerConnection with STUN servers
- **データ同期**: JSON over WebRTC DataChannel

## QA
